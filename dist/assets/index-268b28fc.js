import{J as xe,b as y,c as F,g as B,u as $,R as c,M as u,K as V,r as C,P as ye,Q as je,S as ge,V as Pe,W as _e,j as g,h as I,q as b,p as k,E as Q,o as we,k as a,B as j,n as be,G as x,t as W,L as Oe}from"./index-37d7c688.js";import{u as Ne}from"./useInfiniteQuery-b13f6400.js";import{N as K,D as Se,S as De}from"./SalesSummaries-5e475fbb.js";import{S as G}from"./ShiftSelect-fc49470e.js";import{u as $e}from"./use-form-9d9e9da1.js";import{N as Ce,T as Ee}from"./NumberInput-198d2d3b.js";import{B as Ie,D as Te}from"./DatePickerInput-cfb2e016.js";import"./Input-792a9a59.js";import"./use-uncontrolled-ca768ac3.js";import"./Popover-e9d07091.js";import"./IconChevronLeft-0d65b5dc.js";import"./Select-7c6dd626.js";const[Me,Be]=xe("Drawer component was not found in tree"),R={xs:y(320),sm:y(380),md:y(440),lg:y(620),xl:y(780)};var Re=F((e,{position:t},{size:r})=>({header:{zIndex:1e3},content:{flex:t==="right"||t==="left"?`0 0 ${B({size:r,sizes:R})}`:"0 0 100%",maxWidth:"100%",maxHeight:"100%",height:t==="right"||t==="left"?"100%":B({size:r,sizes:R}),borderRadius:0,overflowY:"auto"},inner:{display:"flex",justifyContent:t==="right"?"flex-end":"flex-start",alignItems:t==="bottom"?"flex-end":"flex-start"}}));const Ye=Re;var He=Object.defineProperty,qe=Object.defineProperties,ze=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,Y=(e,t,r)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_=(e,t)=>{for(var r in t||(t={}))J.call(t,r)&&Y(e,r,t[r]);if(O)for(var r of O(t))U.call(t,r)&&Y(e,r,t[r]);return e},Z=(e,t)=>qe(e,ze(t)),Le=(e,t)=>{var r={};for(var s in e)J.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&O)for(var s of O(e))t.indexOf(s)<0&&U.call(e,s)&&(r[s]=e[s]);return r};const Ae={top:"slide-down",bottom:"slide-up",left:"slide-right",right:"slide-left"},Fe={top:"slide-down",bottom:"slide-up",right:"slide-right",left:"slide-left"},Ve=Z(_({},V),{position:"left"});function X(e){const t=$("DrawerRoot",Ve,e),{classNames:r,variant:s,size:i,scrollAreaComponent:l,position:n,transitionProps:m}=t,d=Le(t,["classNames","variant","size","scrollAreaComponent","position","transitionProps"]),{classes:o,cx:f,theme:p}=Ye({position:n},{name:"Drawer",variant:s,size:i}),h=(p.dir==="rtl"?Fe:Ae)[n];return c.createElement(Me,{value:{scrollAreaComponent:l}},c.createElement(u,_({__staticSelector:"Drawer",size:i,variant:s,transitionProps:_({transition:h,duration:200},m),classNames:Z(_({},r),{content:f(o.content,r==null?void 0:r.content),inner:f(o.inner,r==null?void 0:r.inner)})},d)))}var ke=Object.defineProperty,N=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,H=(e,t,r)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Qe=(e,t)=>{for(var r in t||(t={}))ee.call(t,r)&&H(e,r,t[r]);if(N)for(var r of N(t))te.call(t,r)&&H(e,r,t[r]);return e},We=(e,t)=>{var r={};for(var s in e)ee.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&N)for(var s of N(e))t.indexOf(s)<0&&te.call(e,s)&&(r[s]=e[s]);return r};const Ke={shadow:"xl"},re=C.forwardRef((e,t)=>{const r=$("ModalContent",Ke,e),{children:s,scrollAreaComponent:i}=r,l=We(r,["children","scrollAreaComponent"]),n=Be(),m=i||n.scrollAreaComponent||u.NativeScrollArea;return c.createElement(u.Content,Qe({ref:t,radius:0},l),c.createElement(m,{style:{height:"100vh"}},s))});var Ge=Object.defineProperty,Je=Object.defineProperties,Ue=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable,q=(e,t,r)=>t in e?Ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w=(e,t)=>{for(var r in t||(t={}))ae.call(t,r)&&q(e,r,t[r]);if(S)for(var r of S(t))se.call(t,r)&&q(e,r,t[r]);return e},Ze=(e,t)=>Je(e,Ue(t)),Xe=(e,t)=>{var r={};for(var s in e)ae.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&S)for(var s of S(e))t.indexOf(s)<0&&se.call(e,s)&&(r[s]=e[s]);return r};const et=Ze(w({},V),{withOverlay:!0,withCloseButton:!0});function v(e){const t=$("Drawer",et,e),{title:r,withOverlay:s,overlayProps:i,withCloseButton:l,closeButtonProps:n,children:m}=t,d=Xe(t,["title","withOverlay","overlayProps","withCloseButton","closeButtonProps","children"]),o=!!r||l;return c.createElement(X,w({},d),s&&c.createElement(u.Overlay,w({},i)),c.createElement(re,null,o&&c.createElement(u.Header,null,r&&c.createElement(u.Title,null,r),l&&c.createElement(u.CloseButton,w({},n))),c.createElement(u.Body,null,m)))}v.Root=X;v.CloseButton=u.CloseButton;v.Overlay=u.Overlay;v.Content=re;v.Header=u.Header;v.Title=u.Title;v.Body=u.Body;v.NativeScrollArea=u.NativeScrollArea;var tt=Object.defineProperty,rt=Object.defineProperties,at=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable,L=(e,t,r)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,it=(e,t)=>{for(var r in t||(t={}))st.call(t,r)&&L(e,r,t[r]);if(z)for(var r of z(t))nt.call(t,r)&&L(e,r,t[r]);return e},lt=(e,t)=>rt(e,at(t)),ot=F(e=>({root:lt(it({},e.fn.cover()),{display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"})}));const dt=ot;var ct=Object.defineProperty,ut=Object.defineProperties,mt=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,A=(e,t,r)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,P=(e,t)=>{for(var r in t||(t={}))ne.call(t,r)&&A(e,r,t[r]);if(D)for(var r of D(t))ie.call(t,r)&&A(e,r,t[r]);return e},ft=(e,t)=>ut(e,mt(t)),vt=(e,t)=>{var r={};for(var s in e)ne.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&D)for(var s of D(e))t.indexOf(s)<0&&ie.call(e,s)&&(r[s]=e[s]);return r};const pt={overlayOpacity:.75,transitionDuration:0,radius:0,zIndex:ye("overlay")},le=C.forwardRef((e,t)=>{const r=$("LoadingOverlay",pt,e),{className:s,visible:i,loaderProps:l,overlayOpacity:n,overlayColor:m,transitionDuration:d,exitTransitionDuration:o,zIndex:f,style:p,loader:h,radius:de,overlayBlur:ce,unstyled:T,variant:ue,keepMounted:me}=r,fe=vt(r,["className","visible","loaderProps","overlayOpacity","overlayColor","transitionDuration","exitTransitionDuration","zIndex","style","loader","radius","overlayBlur","unstyled","variant","keepMounted"]),{classes:ve,cx:pe,theme:E}=dt(null,{name:"LoadingOverlay",unstyled:T,variant:ue}),M=`calc(${f} + 1)`;return c.createElement(je,{keepMounted:me,duration:d,exitDuration:o,mounted:i,transition:"fade"},he=>c.createElement(ge,P({className:pe(ve.root,s),style:ft(P(P({},he),p),{zIndex:f}),ref:t},fe),h?c.createElement("div",{style:{zIndex:M}},h):c.createElement(Pe,P({style:{zIndex:M}},l)),c.createElement(_e,{opacity:n,zIndex:f,radius:de,blur:ce,unstyled:T,color:m||(E.colorScheme==="dark"?E.colors.dark[5]:E.white)})))});le.displayName="@mantine/core/LoadingOverlay";async function ht({data:e}){return(await g.post("/handover",e)).data}function xt({config:e}={}){return I(ht,{...e,onSuccess:(...t)=>{b.invalidateQueries(["handovers"]),e!=null&&e.onSuccess&&e.onSuccess(...t)}})}async function yt({id:e}){return(await g.delete(`/handover/${e}`)).data}function Yt({config:e}={}){return I(yt,{...e,onSuccess:(...t)=>{b.invalidateQueries(["handovers"]),e!=null&&e.onSuccess&&e.onSuccess(...t)}})}async function jt({id:e}){return(await g.get(`/handover/${e}`)).data}function gt({config:e,id:t}){return k({...e,queryKey:["handover",t],queryFn:()=>jt({id:t})})}async function oe({params:e}){return(await g.get("/handover",{params:e})).data}function Ht({config:e,params:t}={}){return k({...e,queryKey:["handovers",t],queryFn:()=>oe({params:t}),keepPreviousData:!0})}function Pt({params:e}={}){return Ne({queryKey:["handovers",e],queryFn:({pageParam:t=1})=>oe({params:{...e,page:t}}),getNextPageParam:({metadata:t})=>t.hasNext?t.page+1:void 0,getPreviousPageParam:({metadata:t})=>t.hasPrev?t.page-1:void 0})}async function _t({id:e,data:t}){return(await g.put(`/handover/${e}`,t)).data}function qt({config:e}={}){return I(_t,{...e,onSuccess:(...t)=>{b.invalidateQueries(["handovers"]),b.invalidateQueries(["handover",t[1].id]),e!=null&&e.onSuccess&&e.onSuccess(...t)}})}const zt=()=>{const{outlet:e}=Q(),t=we(),{mutateAsync:r,isLoading:s}=xt(),i=$e({initialValues:{cashReceived:0,cashReturned:0,note:"",shift:0,date:new Date,outlet:e.id}});async function l(){await r({data:i.values},{onSuccess:()=>{be.show({message:"Laporan berhasil dibuat",color:"green"}),t("/handover")},onError:({response:n})=>{i.setErrors((n==null?void 0:n.data).errors)}})}return a.jsxs("main",{children:[a.jsx(K,{title:"Laporan Serah Terima",withBorder:!0}),a.jsxs("section",{className:"px-5 space-y-2",children:[a.jsx(Se,{...i.getInputProps("date"),label:"Tanggal",readOnly:!0,valueFormat:"dddd, D MMMM YYYY"}),a.jsx(G,{...i.getInputProps("shift"),company:e==null?void 0:e.company.id,value:i.values.shift!=0?i.values.shift.toString():"",onChange:n=>i.setFieldValue("shift",parseInt(n??"")),required:!0,label:"Shift",placeholder:"Pilih Shift"}),a.jsx(Ce,{...i.getInputProps("cashReceived"),required:!0,label:"Total Penerimaan",icon:a.jsx("span",{className:"text-xs",children:"Rp"})}),a.jsx(Ee,{...i.getInputProps("note"),required:!0,label:"Catatan",placeholder:"Tambahkan catatan"})]}),a.jsxs("section",{className:"px-5 my-4",children:[a.jsx("div",{className:"mb-3",children:a.jsx("h2",{className:"text-base font-semibold",children:"Penjualan Terakhir"})}),a.jsx(De,{status:"accepted",outlet:e==null?void 0:e.id})]}),a.jsx("div",{className:"fixed bottom-0 w-full max-w-md px-5 bg-white py-4",children:a.jsx(j,{fullWidth:!0,onClick:l,loading:s,children:"Simpan"})})]})},wt=({handoverId:e,onClose:t})=>{const{data:r,isLoading:s,isError:i}=gt({id:e??0,config:{enabled:e!=null}});function l(){return r?r.items.reduce((n,m)=>{const{product:d,quantity:o,total:f}=m,p=n.find(h=>h.id===d.id);return p?(p.quantity+=o,p.total+=f):n.push({id:d.id,name:d.name,price:d.price,quantity:o,total:f}),n},[]):[]}return a.jsxs(v,{opened:e!=null,onClose:t,title:a.jsx("div",{className:"font-bold",children:"Detail Serah Terima"}),padding:"lg",position:"bottom",size:"md",children:[a.jsx(le,{visible:s||i}),r&&a.jsx("section",{children:a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-gray-600",children:"Total Penerimaan"}),a.jsx("div",{className:"font-bold",children:x(r.cashReceived)})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-gray-600",children:"Total Penjualan"}),a.jsx("div",{className:"font-bold",children:x(r.salesTotal)})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-gray-600",children:"Tanggal"}),a.jsx("div",{className:"font-bold",children:W(r.date).format("dddd, D MMMM YYYY")})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-gray-600 mb-1",children:"Catatan"}),a.jsx("p",{className:"text-sm",children:r.note||"-"})]}),a.jsx("div",{className:"border-t-2 border-gray-200 border-dashed pt-2",children:a.jsx("div",{className:"text-gray-900 font-bold mb-1",children:"Penjualan"})}),l().map(n=>a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-gray-900 font-bold",children:n.name}),a.jsxs("div",{className:"text-gray-500 text-xs font-medium",children:[n.quantity," x ",x(n.price)]})]}),a.jsx("div",{className:"font-bold",children:x(n.total)})]},n.id))]})})]})},bt=e=>{const[t,r]=C.useState(null),{data:s,isLoading:i,isFetching:l,hasNextPage:n,fetchNextPage:m}=Pt({params:e}),d=s==null?void 0:s.pages.reduce((o,{result:f})=>[...o,...f],[]);return i?a.jsx("div",{className:"space-x-4 px-5",children:a.jsxs("div",{className:"bg-white w-full rounded-md shadow-md shadow-gray-200 border border-gray-200 p-3",children:[a.jsx("div",{className:"w-full flex items-center justify-between mb-4",children:a.jsx("div",{className:"bg-gray-200 rounded-md h-4 w-20 animate-pulse"})}),a.jsx("div",{className:"bg-gray-200 rounded-md h-6 mb-4 w-full animate-pulse"}),a.jsx("div",{className:"bg-gray-200 rounded-md h-6 w-full animate-pulse"})]})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-5 space-y-4",children:d==null?void 0:d.map(o=>a.jsxs("div",{className:"bg-white w-full rounded-md shadow-md shadow-gray-200 border border-gray-200 p-3",children:[a.jsxs("div",{className:"w-full flex items-center justify-between",children:[a.jsx(Ie,{color:"gray",radius:"sm",children:o.shift.name||"Shift"}),a.jsx("div",{className:"text-gray-600 font-medium text-xs leading-none",children:W(o.date,"YYYY-MM-DD").format("D MMMM YYYY")})]}),a.jsxs("div",{className:"grid grid-cols-2 divide-x divide-gray-300 my-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"Total Penerimaan"}),a.jsx("div",{className:"text-lg font-bold",children:x(o.cashReceived)})]}),a.jsxs("div",{className:"pl-4",children:[a.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"Total Penjualan"}),a.jsx("div",{className:"text-lg font-bold",children:x(o.salesTotal)})]})]}),a.jsx("div",{children:a.jsx(j,{size:"xs",fullWidth:!0,onClick:()=>r(o),children:"Detail"})})]},o.id))}),a.jsxs("div",{className:"px-5",children:[(d==null?void 0:d.length)==0&&a.jsx("div",{children:"Data tidak ditemukan"}),l?a.jsx("div",{className:"text-center mt-2",children:"loading..."}):n&&a.jsx(j,{variant:"subtle",fullWidth:!0,onClick:()=>m(),children:"Lihat Semua"})]}),a.jsx(wt,{handoverId:(t==null?void 0:t.id)||null,onClose:()=>r(null)})]})},Lt=()=>{var i;const{outlet:e}=Q(),[t,r]=C.useState({outlet:e==null?void 0:e.id});function s(){r({outlet:e==null?void 0:e.id})}return a.jsxs("main",{children:[a.jsx(K,{withBorder:!0,to:"/"}),a.jsxs("section",{className:"px-5",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(G,{label:"Shift",placeholder:"Pilih Shift",company:e==null?void 0:e.company.id,value:((i=t.shift)==null?void 0:i.toString())??"",onChange:l=>r({...t,shift:parseInt(l||"")})}),a.jsx(Te,{type:"range",valueFormat:"D MMMM YYYY",label:"Rentang Tanggal",placeholder:"Pilih Tanggal",allowSingleDateInRange:!0,value:[t.startDate||null,t.endDate||null],onChange:([l,n])=>r({...t,startDate:l||void 0,endDate:n||void 0})})]}),a.jsx("div",{className:"flex items-center justify-end space-x-2 mt-4",children:a.jsx(j,{size:"xs",variant:"default",onClick:s,children:"Clear"})})]}),a.jsxs("section",{className:"mt-6",children:[a.jsxs("div",{className:"px-5 mb-4 flex items-center justify-between",children:[a.jsx("h2",{className:"font-bold",children:"Rekap Serah Terima"}),a.jsx(j,{component:Oe,to:"/handover/create",size:"xs",children:"Tambah"})]}),a.jsx(bt,{...t})]})]})};export{zt as HandoverCreate,Lt as Handovers,ht as createHandover,yt as deleteHandover,jt as getHandover,oe as getHandovers,_t as updateHandover,xt as useCreateHandover,Yt as useDeleteHandover,gt as useHandover,Ht as useHandovers,Pt as useInfiniteHandovers,qt as useUpdateHandover};
